<div class="app-layout">
  <app-sidebar></app-sidebar>

  <div class="page-body">
    <main class="page-content">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

<!-- Botón flotante de chat IA -->
<button
  class="floating-chat-btn"
  (click)="toggleChat()"
  [class.open]="showChat"
  aria-label="Abrir chat IA"
>
  IA
</button>

<!-- Panel de chat flotante -->
<div class="floating-chat-panel" [class.open]="showChat">
  <div class="panel-header">
    <h5>Chat IA</h5>
    <button class="btn-close" aria-label="Cerrar" (click)="toggleChat()">×</button>
  </div>

  <div class="panel-body">
    <div class="history-select">
      <label for="historiaSelect">Historia:</label>
      <select id="historiaSelect" [(ngModel)]="selectedHistoriaId">
        <option [ngValue]="null">-- Seleccionar --</option>
        <option *ngFor="let h of histories" [ngValue]="h.id">{{ h.titulo }}</option>
      </select>
    </div>
    <div class="messages" *ngIf="messages.length; else emptyMsg">
      <div
        *ngFor="let m of messages"
        class="msg"
        [ngClass]="m.from === 'user' ? 'user' : 'ai'"
      >
        {{ m.text }}
      </div>
    </div>
    <ng-template #emptyMsg>
      <div class="empty">
        Bienvenido al chat IA.<br />
        Escribe tu pregunta abajo.
      </div>
    </ng-template>
  </div>

  <div class="panel-footer">
    <input
      type="text"
      [(ngModel)]="newMessage"
      (keyup.enter)="sendMessage()"
      placeholder="Escribe tu pregunta..."
    />
    <button class="send-btn" (click)="sendMessage()">Enviar</button>
  </div>
</div>
