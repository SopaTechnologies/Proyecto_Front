<div class="forum-list">
  <ng-container *ngIf="forumPosts && forumPosts.length; else emptyState">
    <div class="forum-list__grid">
      <article
        class="forum-card"
        *ngFor="let post of forumPosts"
        (click)="openDetails(post)"
      >
        <!-- Fila superior: título + acciones -->
        <div class="forum-card__header">
          <div class="forum-card__title-block">
            <span class="pill pill-soft">
              <i class="fas fa-book-open"></i>
              Historia
            </span>

            <h3 class="forum-card__title">
              {{ post.storyTitle || 'Historia sin título' }}
            </h3>
          </div>

          <div class="forum-card__actions" (click)="$event.stopPropagation()">
            <span
              class="visibility-tag"
              [class.visibility-tag--private]="!post.isPublic"
            >
              <i
                class="fas"
                [ngClass]="post.isPublic ? 'fa-globe-americas' : 'fa-lock'"
              ></i>
              {{ post.isPublic ? 'Pública' : 'Privada' }}
            </span>

            <button
              class="icon-btn"
              *ngIf="isOwner(post)"
              type="button"
              title="Editar publicación"
              (click)="onEdit(post)"
            >
              <i class="fas fa-pen"></i>
            </button>

            <button
              class="icon-btn icon-btn--danger"
              *ngIf="isOwner(post)"
              type="button"
              title="Eliminar publicación"
              (click)="onDelete(post)"
            >
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <!-- Meta -->
        <div class="forum-card__meta">
          <span class="meta-chip">
            <i class="fas fa-user"></i>
            {{ post.authorName || 'Autor desconocido' }}
          </span>

          <span class="meta-chip" *ngIf="post.publishedAt">
            <i class="fas fa-clock"></i>
            {{ post.publishedAt | date: 'short' }}
          </span>

          <span class="meta-chip" *ngIf="post.genre">
            <i class="fas fa-tag"></i>
            {{ post.genre }}
          </span>

          <span class="meta-chip">
            <i class="fas fa-eye"></i>
            {{ post.views || 0 }} vistas
          </span>

          <span class="meta-chip">
            <i class="fas fa-comments"></i>
            {{ post.comments || 0 }} comentarios
          </span>
        </div>

        <!-- Sinopsis -->
        <p class="forum-card__synopsis">
          {{ post.synopsis }}
        </p>
      </article>
    </div>
  </ng-container>

  <ng-template #emptyState>
    <div class="empty-state">
      <div class="empty-state__card">
        <i class="fas fa-magic"></i>
        <h3>Sin publicaciones todavía</h3>
        <p>
          No hay historias publicadas en el foro. Sé el primero en compartir
          una usando el botón <strong>“Publicar historia”</strong>.
        </p>
      </div>
    </div>
  </ng-template>
</div>
